# 子 Issue Template 項目定義

`orchestrator-manager/assets/dag-node-issue-body.template.md` の各項目に、何をどう書くかを定義する。
このガイドは DAG ノード（子 issue）作成時の基準として使う。

## 共通ルール

1. 1 子 issue = 1 PR で完結する単位にする。
2. `depends_on` は最小限にし、不要な直列依存を作らない。
3. 受け入れ条件はすべて検証可能に書く（数値・閾値・件数のいずれかを含める）。

## 項目別定義

### `dag_run_id`（自動）

- 何を書くか: DAG 実行単位を識別する ID。
- 最低条件: 自動採番された同一 run の共通値である。
- 備考: 手動編集しない。

### `root_issue`（自動）

- 何を書くか: 親 root issue 番号。
- 最低条件: 実在する issue 番号である。
- 備考: 手動編集しない。

### `dag_node_id`

- 何を書くか: DAG ノードを一意に識別する ID。
- 最低条件: 同一 root 配下で重複しない。
- 良い例: `impl-porters-auth-01`
- 悪い例: `task`, `node`

### `depends_on`

- 何を書くか: 先行完了が必要な `dag_node_id` の CSV。
- 最低条件: 依存先は同一 root 配下に存在し、循環参照しない。
- 良い例: `spec-porters-fields-01,db-schema-01`
- 良い例: `none`（依存なし）
- 悪い例: `あとで決める`

### `Root Issue` セクション（自動）

- 何を書くか: 親 root issue の番号と URL。
- 最低条件: 番号と URL の両方で親を辿れる。
- 備考: 自動埋め込みのため手動編集しない。

### `Task Description`

- 何を書くか: 実装者が着手できる具体タスク。
- 最低条件: 対象・操作・期待結果が入っている。
- 良い例: `Porters API の OAuth 認証処理を実装し、期限切れ時は 1 回だけトークン再取得して再試行する。`
- 悪い例: `API 対応を行う。`

### `Acceptance Criteria`（チェックボックス）

- 何を書くか: 完了判定条件（`- [ ]` で列挙）。
- 最低条件: 各行が検証可能で、数値・閾値・件数を含む。
- 良い例: `- [ ] POST /api/porters/sync 実行時の成功ステータスが 200 で、失敗率が 1% 未満である。`
- 良い例: `- [ ] 同期対象 200 件を 1 リクエスト単位で分割し、分割漏れ件数が 0 件である。`
- 悪い例: `- [ ] 正しく動くこと`

## 子 Issue 受け入れ条件の作法

1. API 実装: ステータスコード、エラーレート、必須レスポンス項目数を条件化する。
2. 性能改善: p95 / p99、タイムアウト率、処理件数あたり時間を条件化する。
3. バッチ実装: 実行時刻制約、総処理件数、再実行時の重複件数を条件化する。
4. データ設計: 作成テーブル数、必須カラム数、NOT NULL/PK/FK の制約数を条件化する。

## 確認観点（レビュー時）

1. 親 root の目的に直接つながるタスクか。
2. `depends_on` が最小構成になっているか。
3. 受け入れ条件だけで完了判定できるか。
